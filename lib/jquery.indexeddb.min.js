(function(g,i){var a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;var c=window.IDBKeyRange||window.webkitIDBKeyRange;var f=window.IDBCursor||window.webkitIDBCursor||{};try{f.PREV=f.PREV||"prev";f.NEXT=f.NEXT||"next"}catch(h){}var d=window.IDBTransaction||window.webkitIDBTransaction;function b(l){var j=null;try{switch(l){case 0:case 1:case"readwrite":case"readonly":j=l;break;default:j=d.READ_WRITE||"readwrite"}}catch(k){j="readwrite"}return j}g.extend({indexedDB:function(o,l){if(l){if(typeof l==="number"){l={version:l}}var k=l.version;if(l.schema&&!k){var j=-1;for(var m in l.schema){j=j>m?j:m}k=l.version||j}}var n={request:function(q,p){return g.Deferred(function(r){try{var s=typeof q==="function"?q(p):q;s.onsuccess=function(u){r.resolveWith(s,[s.result,u])};s.onerror=function(u){r.rejectWith(s,[s.error,u])};if(typeof s.onblocked!=="undefined"&&s.onblocked===null){s.onblocked=function(v){var u;try{u=s.result}catch(v){u=null}r.notifyWith(s,[u,v])}}if(typeof s.onupgradeneeded!=="undefined"&&s.onupgradeneeded===null){s.onupgradeneeded=function(u){r.notifyWith(s,[s.result,u])}}}catch(t){t.name="exception";r.rejectWith(s,["exception",t])}})},transaction:function(p){return{objectStore:function(q){try{return n.objectStore(p.objectStore(q))}catch(r){p.readyState!==p.DONE&&p.abort();return n.objectStore(null)}},createObjectStore:function(r,q){try{return n.objectStore(p.db.createObjectStore(r,q))}catch(s){p.readyState!==p.DONE&&p.abort()}},deleteObjectStore:function(q){try{p.db.deleteObjectStore(q)}catch(r){p.readyState!==p.DONE&&p.abort()}},abort:function(){p.abort()}}},objectStore:function(q){var p={};var s=["add","put","get","delete","clear","count"];for(var r=0;r<s.length;r++){p[s[r]]=(function(t){return function(){return n.request(function(u){return q[t].apply(q,u)},arguments)}})(s[r])}p.each=function(v,t,u){return n.cursor(function(){if(u){return q.openCursor(n.range(t),u)}else{return q.openCursor(n.range(t))}},v)};p.index=function(t){return n.index(function(){return q.index(t)})};p.createIndex=function(v,t,u){if(arguments.length===2&&typeof t==="string"){u=arguments[1];t=null}if(!u){u=v}return n.index(function(){return q.createIndex(u,v,t)})};p.deleteIndex=function(t){return q.deleteIndex(t)};return p},range:function(p){if(g.isArray(p)){if(p.length===1){return c.only(p[0])}else{return c.bound(p[0],p[1],(typeof p[2]==="undefined")?false:p[2],(typeof p[3]==="undefined")?false:p[3])}}else{if(typeof p==="undefined"){return null}else{return p}}},cursor:function(q,p){return g.Deferred(function(r){try{var s=typeof q==="function"?q():q;s.onsuccess=function(w){if(!s.result){r.resolveWith(s,[null,w]);return}var v={"delete":function(){return n.request(function(){return s.result["delete"]()})},update:function(x){return n.request(function(){return s.result.update(x)})},next:function(x){this.data=x},key:s.result.key,value:s.result.value};r.notifyWith(s,[v,w]);var u=p.apply(s,[v]);try{if(u===false){r.resolveWith(s,[null,w])}else{if(typeof u==="number"){s.result.advance.apply(s.result,[u])}else{if(v.data){s.result["continue"].apply(s.result,[v.data])}else{s.result["continue"]()}}}}catch(w){r.rejectWith(s,[s.result,w])}};s.onerror=function(u){r.rejectWith(s,[s.result,u])}}catch(t){t.type="exception";r.rejectWith(s,[null,t])}})},index:function(q){try{var p=(typeof q==="function"?q():q)}catch(r){p=null}return{each:function(u,s,t){return n.cursor(function(){if(t){return p.openCursor(n.range(s),t)}else{return p.openCursor(n.range(s))}},u)},eachKey:function(u,s,t){return n.cursor(function(){if(t){return p.openKeyCursor(n.range(s),t)}else{return p.openKeyCursor(n.range(s))}},u)},get:function(s){if(typeof p.get==="function"){return n.request(p.get(s))}else{return p.openCursor(n.range(s))}},count:function(){if(typeof p.count==="function"){return n.request(p.count())}else{throw"Count not implemented for cursors"}},getKey:function(s){if(typeof p.getKey==="function"){return n.request(p.getKey(s))}else{return p.openKeyCursor(n.range(s))}}}}};var e=n.request(function(){return k?a.open(o,parseInt(k)):a.open(o)});e.then(function(p,q){p.onversionchange=function(){if(!(l&&l.onversionchange&&l.onversionchange()!==false)){p.close()}}},function(p,q){},function(p,r){if(r&&r.type==="upgradeneeded"){if(l&&l.schema){for(var q=r.oldVersion+1;q<=r.newVersion;q++){typeof l.schema[q]==="function"&&l.schema[q].call(this,n.transaction(this.transaction))}}if(l&&typeof l.upgrade==="function"){l.upgrade.call(this,n.transaction(this.transaction))}}});return g.extend(e,{cmp:function(q,p){return a.cmp(q,p)},deleteDatabase:function(){return g.Deferred(function(p){e.then(function(q,r){q.close();n.request(function(){return a.deleteDatabase(o)}).then(function(s,t){p.resolveWith(this,[s,t])},function(s,t){p.rejectWith(this,[s,t])},function(s,t){p.notifyWith(this,[s,t])})},function(q,r){p.rejectWith(this,[q,r])},function(q,r){p.notifyWith(this,[q,r])})})},transaction:function(p,q){!g.isArray(p)&&(p=[p]);q=b(q);return g.Deferred(function(r){e.then(function(s,u){var t;try{t=s.transaction(p,q);t.onabort=t.onerror=function(v){r.rejectWith(t,[v])};t.oncomplete=function(v){r.resolveWith(t,[v])}}catch(u){u.type="exception";r.rejectWith(this,[u]);return}try{r.notifyWith(t,[n.transaction(t)])}catch(u){u.type="exception";r.rejectWith(this,[u])}},function(s,t){r.rejectWith(this,[t,s])},function(s,t){})})},objectStore:function(v,t){var u=this,x={};function s(y){return g.Deferred(function(z){function A(B,D){try{D(B.objectStore(v)).then(function(E,F){z.resolveWith(this,[E,F])},function(E,F){z.rejectWith(this,[E,F])})}catch(C){C.name="exception";z.rejectWith(B,[C,C])}}u.transaction(v,b(t)).then(function(){},function(C,D){if(C.code===C.NOT_FOUND_ERR&&(t===true||typeof t==="object")){var B=this.result;B.close();e=n.request(function(){return a.open(o,(parseInt(B.version,10)||1)+1)});e.then(function(E,F){E.onversionchange=function(){if(!(l&&l.onversionchange&&l.onversionchange()!==false)){E.close()}};u.transaction(v,b(t)).then(function(){},function(G,H){z.rejectWith(this,[G,H])},function(G,H){A(G,y)})},function(E,F){z.rejectWith(this,[E,F])},function(E,G){if(G.type==="upgradeneeded"){try{E.createObjectStore(v,t===true?{autoIncrement:true}:t)}catch(F){z.rejectWith(this,[F,G])}}})}else{z.rejectWith(this,[C,D])}},function(B){A(B,y)})})}function q(y,z){return s(function(A){return A[y].apply(A,z)})}function p(y,A,z){return s(function(C){var B=C.index(A);return B[y].apply(B[y],z)})}var w=["add","delete","get","put","clear","count","each"];for(var r=0;r<w.length;r++){x[w[r]]=(function(y){return function(){return q(y,arguments)}})(w[r])}x.index=function(y){return{each:function(B,z,A){return p("each",y,[B,z,A])},eachKey:function(B,z,A){return p("eachKey",y,[B,z,A])},get:function(z){return p("get",y,[z])},count:function(){return p("count",y,[])},getKey:function(z){return p("getKey",y,[z])}}};return x}})}});g.indexedDB.IDBCursor=f;g.indexedDB.IDBTransaction=d;g.idb=g.indexedDB})(jQuery);